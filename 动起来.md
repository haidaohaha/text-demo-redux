## åŠ¨èµ·æ¥

## è£…ä¸¤ä¸ªä¾èµ–

```
yarn add redux
yarn add react-redux
```

æˆ‘æƒ³å¹²å˜›ï¼Œå®žçŽ° redux ç‰ˆçš„å—æŽ§æ•°å­—
åŒæ­¥çš„ä»£ç å·²ç»å®žçŽ°ï¼Œå¼‚æ­¥éœ€è¦å¢žåŠ ä¸­é—´ä»¶ ...
æœ¬èŠ‚ çº¯ redux å¹²äº†å“ªäº›äº‹æƒ…ï¼ŒæŸ¥çœ‹ demo.redux
é‡è¦çš„æ˜¯ Appjs ç»“åˆ redux

## è‡ªå·±å°è£…ä¸€ä¸ªç®€åŒ–çš„ my.redux

-   é‡åˆ°çš„å›°éš¾æ˜¯ dispatch(action) return action;
-   åœ¨è¿™ä¸­é—´ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘å¹¶æ²¡æœ‰æƒ³æ¸…æ¥š
-   æœ€é‡è¦çš„æ˜¯è§¦å‘äº† reducer å‡½æ•°
-   è¿™æ—¶å€™ä½ å°±åº”è¯¥å›žæƒ³ä¸€ä¸‹ï¼Œreducer å¹²äº†é‚£äº›äº‹
-   redux æœ‰ä¸ªæ—¶é—´çº¿ï¼Œ reducer è¿”å›žçš„æ•°æ®è¦è¿˜ç»™ state
-   æœ€å¥½è¦å‘Šè¯‰ï¼Œæ‰€æœ‰çš„è®¢é˜…è€…

æŽ˜é‡‘æ–‡ç« ï¼š [è§£æž redux](https://juejin.im/post/5b29025ee51d4558b64f10bf)

## ä¸‹é¢æˆ‘æƒ³å®žçŽ°ä¸€ä¸‹ react-redux

-   è¡¥å……çŸ¥è¯† äº†è§£ context (ä¹‹å‰çœ‹åˆ«äººå†™ï¼Œç”¨ context çœ‹çš„äº‘é‡Œé›¾é‡Œçš„)
-   ä»Šå¤©å†™å®Œ context æˆ‘æƒ³çœ‹çœ‹ è‹±æ–‡ç‰ˆçš„ context ç»“æŸ ðŸ˜‚

> é—®é¢˜ï¼šç»„ä»¶å¤šå±‚åµŒå¥—æ—¶ï¼Œæœ€å†…çš„ç»„ä»¶æƒ³ä½¿ç”¨æœ€å¤–å±‚çš„å±žæ€§ï¼Œå¦‚ä½•æ“ä½œï¼Ÿ

1ã€ä½¿ç”¨ props å±‚å±‚ä¼ é€’ï¼›ï¼ˆè¿™ä¸ªå°±ä¸æŽ©é¥°äº†ï¼‰  
2ã€ä½¿ç”¨ context æŸ¥çœ‹ demo.context.js æ–‡ä»¶ï¼›

åŸºæœ¬çš„ç»“æž„ï¼Œå®Œæˆä¹‹åŽï¼Œå®‰è£…ä¸€ä¸ªä¾èµ–

```
yarn add prop-types
```

ä½¿ç”¨ context éœ€è¦å¯¹ ç±»åž‹è¿›è¡Œè®¾ç½®ï¼Œä¸è®¾ç½®ä¸ç»™ç”¨ ðŸ˜…  
å“Žï¼å†™ä¸€å†™ï¼Œæ‰‹ä¸å¹²å‡€å•Šï¼Œç»™è‡ªå·±æŒ–äº†ä¸ªå‘  
çœ‹ä¼šä¹¦ç¼“ç¼“...

## å¼€å§‹æ“åˆ€ï¼Œå®žçŽ° react-redux

ä»Šå¤©æ—©ä¸Šï¼Œé—²é€›æŽ˜é‡‘å®˜ç½‘ï¼Œå‘çŽ°æœ‰ä¸ªå¤§ä½¬ä¹Ÿåœ¨æ€»ç»“ï¼Œè¿™æ–¹ä¾¿çš„ä¸œè¥¿ï¼Œ  
è™½ç„¶æˆ‘è§‰å¾—ï¼Œæˆ‘ä¹Ÿèƒ½å†™ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ›´æ—©å¼€å§‹å†™çš„ï¼Œå¦‚æžœåœ¨æ—©ä¸€ç‚¹ï¼Œæˆ‘èƒ½åšæŒ  
è‚¯å®šä¸æ˜¯çŽ°åœ¨è¿™ç§æƒ…å†µï¼ŒçŽ°åœ¨æ˜¯æœ€ä½³æ—¶æœºï¼Œè®°ä½ä½ çš„ç›®æ ‡ï¼Œä¿æŒâ€˜é¥±æ»¡â€™ðŸ˜

å¼€å¹²ä»Šå¤©çš„ï¼š

-   ä¸€ä¸ªä½Žçº§é”™è¯¯ï¼Œ my.react.redux ä¸¤ä¸ªæ–¹æ³•ï¼ŒåŽä¸€ä¸ªæŠ¥é”™ï¼Œæ½œæ„è¯†è®¤ä¸ºç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å¯¹çš„ï¼Œå®žè´¨ç¬¬ä¸€ä¸ªå°±æ²¡ç”¨ï¼Œæ‰¾é”™é€»è¾‘ä¸å¯¹ï¼›
-   Provider å¦‚ä½•ç†è§£ä½¿ç”¨ this.store
-   æ‰€è°“çš„â€œç©¿é€â€ æ²¡ç†è§£ï¼›
-   Provider æä¾›åŒ…è£¹ ï¼Œ æ”¯æŒ connect å®žçŽ°ç»„ä»¶é“¾æŽ¥ store

## çœ‹åˆ°é«˜é˜¶ç»„ä»¶ï¼Œå¿ƒé‡Œå‘æ€µï¼Œè¿˜æ²¡çœ‹å‘¢ï¼Œå°±é€†åï¼

çŽ°åœ¨è¿™æ ·ï¼Œå°±å…ˆå–å·§äº†ï¼Œçœ‹å®Œï¼Œç®€å•ç”»ç”»ï¼Œå¤§çš„ç»“æž„ï¼Œå›´ç»•ç€ç›®æ ‡ï¼Œå†æƒ³ä¸€æƒ³ï¼Œä¸­é—´çš„è¿™æ ·ï¼Œä¸ºç›®æ ‡åšäº†ä»€ä¹ˆé“ºåž«æœ€ç»ˆå®žçŽ°äº†æ€Žæ · XX çš„èƒ½åŠ›ï¼›

-   ä¹¦å†™ä¸­é—´ä»¶æ—¶ï¼Œå­˜åœ¨æŠ¥é”™ï¼Œæ˜¾ç¤º ä¸æ”¯æŒ ... è¯­æ³•

```
npm run eject
```

æ³¨æ„ï¼šä½ å¯ä»¥å•ç‹¬å®‰è£… loader ï¼Œä¸Šé¢çš„æ“ä½œæ˜¯ï¼Œä¸å¯é€†çš„æ“ä½œã€‚  
é‡æ–°å®‰è£…ä»¥åŽè§£å†³æŠ¥é”™é—®é¢˜

> > å¯æƒœäº†ï¼Œå¼‚æ­¥å¢žåŠ ï¼Œè¿˜æ˜¯æ²¡èƒ½å¦‚æ„¿ï¼Œè§£å†³  
> > ä¸¤ä¸ªæ–¹ä¾¿ ï¼š1ã€run eject ä¹‹å‰ï¼Œæˆ‘ä¼šé€€äº† index æ–‡ä»¶ï¼Œæ²¡æœ‰å¼•å…¥ applyMiddleware

          2ã€run eject åˆå§‹åŒ–æ—¶ä¸åŒ…å« redux-thunk ä¾èµ–çš„ æ‰€ä»¥ åŒæ­¥çš„ åŠ å‡ æ­£å¸¸ï¼Œä½†æ˜¯å¼‚æ­¥çš„ä¸è¡Œï¼Œä¹‹é—´è¿”å›žçš„æ–¹æ³•ï¼Œä¸èƒ½åƒåŒæ­¥é‚£æ ·è¿”å›ž action

## è¿›é˜¶ä¸­é—´ä»¶ å®žçŽ°ä¸€ä¸‹ redux-thunk

-   å…¶å®žè¿˜æ˜¯ï¼Œäº‘é‡Œé›¾é‡Œçš„ï¼Œç†è§£æ‰©å±•â€œæ­¦å™¨åº“/åŠŸèƒ½â€
-   å†™å®Œ thunk è™½ç„¶ä»£ç é‡ä¸å¤šï¼Œä½†æ˜¯çœŸä¸å¥½ç†è§£ï¼Œå‰é¢çš„æ¯ä¸€æ­¥ï¼Œä½ éƒ½å¿…é¡»æ¸…æ™°
-   å®šåˆ¶ä¸­é—´ä»¶ , çœ‹ç€å¥½ç¥žå¥‡å•Šï¼Œè¿™éƒ½èƒ½æ‰§è¡Œï¼ˆæ³¨æ„å‚æ•°å†…æœ‰æ–¹æ³•ï¼Œé…åˆå…¶å®ƒä¸­é—´ä»¶ä¹Ÿæ˜¯å¯ä»¥æ‰§è¡Œçš„ï¼‰ã€‚

```
// å®šåˆ¶ä¸­é—´ä»¶ ä½¿ç”¨ å‡½æ•°
export function AddNumRandom() {
    // return [{ type: INCREMENT }, { type: INCREMENT }];
    return [{ type: INCREMENT }, AddNumAsync(), AddNumAsync()];
}
```

-   ä¸­é—´ä»¶ï¼Œç»™åŠ›ï¼Œéš¾æ€ªåˆä¸“é—¨çš„ â€œä¸­é—´ä»¶â€ æ¯”èµ›
-   ä¸­é—´ä»¶çš„å†™æ³•,å¯ä»¥å‚ç…§ arrThunk , ä¸‰ä¸ªç®­å¤´å‡½æ•°, åœ¨ä¸­é—´ä»¶è¿›è¡Œæ‰©å±•,å¦‚ å‚æ•°æ˜¯æ•°ç»„,å…ƒç´ æœ‰æ–¹æ³•,æœ‰å¯¹è±¡,é‚£å°±åˆ†å¼€æ‰§è¡Œ; æ‹†è§£æ•°ç»„æ–¹æ³•çš„ä¸­é—´ä»¶,æ‰§è¡Œè¿”å›žçš„æ˜¯å¯¹è±¡,å†æ¬¡æ‰§è¡Œæ—¶,ä¸æ»¡è¶³å½“å‰çš„ä¸­é—´ä»¶,ä¹Ÿä¸æ»¡è¶³å…¶å®ƒçš„æ—¶å€™,æ‰§è¡Œ åŽŸç”Ÿçš„; å¦‚æžœæ—¶æ–¹æ³•é‚£å°±åŽ»åœ¨ ä¸­é—´ä»¶ thunk å†…æ‰§è¡Œ,é€»è¾‘ä¸€æ ·. 

```
const arrThunk = ({ getState, dispatch }) => next => action => {
    if (Array.isArray(action)) {
        return action.forEach(v => dispatch(v));
    }
    return next(action);
};
export default arrThunk;
```
